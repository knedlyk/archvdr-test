# Maintainer  : Edgar Hucek <gimli at dark-green dot com>
name=xbmc-pvr-addons
pkgname=$name-osd
pkgver=20130115
pkgrel=1
#gitid=a9780e023c8b7728017851bfd12d4df9e5c26993
pkgdesc="XBMC-pvr addons"
arch=('i686' 'x86_64' 'arm')
url="https://github.com/opdenkamp/xbmc-pvr-addons"
license=('GPL2')
depends=('xbmc-git')
makedepends=('gcc' 'git' 'xbmc-git')
backup=()
conflicts=(vdr-pvr-addons)
md5sums=()

build() {
  cd "$srcdir/"	|| return 1
  
  _githost="https://github.com/opdenkamp"
  _githost="https://github.com/FernetMenta"
  _gitrepo="xbmc-pvr-addons.git"

  if [ -e $srcdir/${name} ]; then	  
    cd $srcdir/${name}
    git checkout master
    git pull --rebase
    git checkout $gitid
  else
    git clone -b osd ${_githost}/${_gitrepo}
    cd $srcdir/${name}
    git checkout $gitid
  fi

  if [ -e $srcdir/${name}-build ]; then
    rm -rf $srcdir/${name}-build
  fi

  cp -r $srcdir/${name} $srcdir/${name}-build

  cd $srcdir/${name}-build

  # remove "--as-needed" from LDFLAGS
  unset LDFLAGS; LDFLAGS="-Wl,--hash-style=gnu"

  msg "Bootstrapping pvr addons"
  ./bootstrap

  msg "Configuring pvr addons" 
  export PYTHON_VERSION=2  # external python v2
  ./configure --prefix=/usr

  make
  make DESTDIR=${pkgdir}/ install
}
