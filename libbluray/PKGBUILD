# Contributor: Edgar Hucek <gimli at dark-green dot com>

pkgname=libbluray
pkgver=20130115
pkgrel=1
pkgdesc="BluRay library."
url="http://git.videolan.org/?p=libbluray.git;a=summary"
arch=('i686' 'x86_64')
license=('LGPL2.1')
depends=('libxml2')
makedepends=('git' 'gcc' 'autoconf' 'apache-ant' 'jdk7-openjdk')
source=()
md5sums=()
conflicts=()

build() {
  
  cd ${srcdir}

  _githost="git://git.videolan.org"
  _gitrepo="libbluray.git"
  _gitid=217254bccfb04f421d30b94708f108f5c48e72ad

  if [ -e $srcdir/${pkgname} ]; then	  
    cd $srcdir/${pkgname}
    git checkout master; git pull --rebase
    git checkout $_gitid
  else
    git clone ${_githost}/${_gitrepo}
    cd $srcdir/${pkgname}
    git checkout $_gitid
  fi

  if [ -e $srcdir/${pkgname}-build ]; then
    rm -rf $srcdir/${pkgname}-build
  fi

  cp -r $srcdir/${pkgname} $srcdir/${pkgname}-build
  cd $srcdir/${pkgname}-build

  source /etc/profile.d/jdk.sh

  sed 's|AM_CONFIG_HEADER(config.h)|AC_CONFIG_HEADERS([config.h])|g' -i configure.ac

  ./bootstrap

  ./configure --prefix=/usr --enable-bdjava --with-jdk="${JAVA_HOME}" --disable-static

  make

  make DESTDIR=$pkgdir install
  install -m 0644 $srcdir/${pkgname}-build/src/libbluray/bdnav/navigation.h $pkgdir/usr/include/libbluray
  install -m 0644 $srcdir/${pkgname}-build/src/libbluray/bdnav/mpls_parse.h $pkgdir/usr/include/libbluray
  install -m 0644 $srcdir/${pkgname}-build/src/libbluray/bdnav/clpi_parse.h $pkgdir/usr/include/libbluray
  mkdir -p $pkgdir/usr/include/libbluray/util
  install -m 0644 $srcdir/${pkgname}-build/src/util/*.h $pkgdir/usr/include/libbluray/util

  #mkdir -p $pkgdir/usr/lib/vdr/plugins/ || return 1

}
